#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ÔøΩÔøΩ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."

# –£–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–∑ –∫–æ—Ä–Ω—è (–µ—Å–ª–∏ –æ—Å—Ç–∞–ª–∏—Å—å)
rm -f *.png 2>/dev/null || true
rm -f *-debug.png 2>/dev/null || true
rm -f *-screenshot.png 2>/dev/null || true

# –£–¥–∞–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é tests/artifacts –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
rm -rf tests/artifacts/ 2>/dev/null || true

# –£–¥–∞–ª—è–µ–º –¥—Ä—É–≥–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
rm -f debug.log 2>/dev/null || true
rm -f audit.json 2>/dev/null || true

# –û—á–∏—Å—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤
if [ -d "test-results" ]; then
  echo "  üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ test-results/"
  rm -rf test-results/*
fi

# –û—á–∏—Å—Ç–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Ç–µ—Å—Ç–æ–≤
if [ -d "tests/e2e/artifacts" ]; then
  echo "  üóëÔ∏è  –û—á–∏—Å—Ç–∫–∞ tests/e2e/artifacts/"
  rm -rf tests/e2e/artifacts/*
fi

# –£–¥–∞–ª–µ–Ω–∏–µ log —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ—Ä–Ω–µ
if [ -f "server-error.log" ]; then
  echo "  üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ server-error.log"
  rm -f server-error.log
fi

# –£–¥–∞–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö log —Ñ–∞–π–ª–æ–≤
find . -name "*.log" -not -path "./node_modules/*" -not -path "./bitcoin-moon/*" -not -path "./.git/*" -type f | while read logfile; do
  if [ -f "$logfile" ]; then
    echo "  üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ $logfile"
    rm -f "$logfile"
  fi
done

# –û—á–∏—Å—Ç–∫–∞ Playwright –∫—ç—à–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
if [ -d "playwright-report" ]; then
  echo "  üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ playwright-report/"
  rm -rf playwright-report
fi

if [ -d ".playwright" ]; then
  echo "  üóëÔ∏è  –û—á–∏—Å—Ç–∫–∞ .playwright –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤"
  find .playwright -name "*.png" -o -name "*.webm" -o -name "*.zip" | head -20 | xargs rm -f 2>/dev/null || true
fi

# –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ Docker
if [ -f "docker-compose.override.yml" ]; then
  echo "  üóëÔ∏è  –£–¥–∞–ª–µ–Ω–∏–µ docker-compose.override.yml"
  rm -f docker-compose.override.yml
fi

echo "‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –æ—á–∏—â–µ–Ω—ã"

# –ó–∞–ø—É—Å–∫ –ª–∏–Ω—Ç–µ—Ä–æ–≤ (–∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤)
# npx lint-staged

exit 0
