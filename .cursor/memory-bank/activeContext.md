# Активный контекст проекта MoonBit

## Текущее состояние проекта

На данный момент проект находится в стадии восстановления после потери некоторых файлов. Серверная часть имеет реализованные API для работы с данными о биткоине, фазах луны, астрологических событиях и пользовательских событиях, но некоторые ключевые сервисы требуют восстановления. Клиентская часть имеет базовую структуру с компонентами для отображения данных. Настроена система тестирования для серверной и клиентской частей проекта.

## Текущий фокус разработки

### Восстановление сервисов
Сейчас наш основной фокус на восстановлении серверной части проекта:
- ✅ Восстановлен сервис логирования (logger.js)
- ✅ Восстановлен сервис синхронизации данных (DataSyncService.js)
- ✅ Восстановлен сервис для работы с данными о биткоине (BitcoinService.js)
- ✅ Восстановлен сервис для работы с данными о луне (MoonService.js)
- ✅ Восстановлен сервис для работы с астрологическими данными (AstroService.js)
- ✅ Восстановлен сервис для работы с событиями (EventsService.js)

### Тестирование
- ✅ Созданы интеграционные тесты для проверки взаимодействия между сервисами
- ⬜ Необходимо добавить модульные тесты для отдельных сервисов
- ⬜ Необходимо настроить CI/CD для автоматического запуска тестов

### Клиентская часть
- ✅ Основные компоненты React реализованы
- ⬜ Необходимо улучшить UX при загрузке данных
- ⬜ Необходимо оптимизировать производительность компонентов
- ⬜ Необходимо добавить динамическое переключение темы в зависимости от фазы луны

## Недавние изменения

### Последние коммиты
- [server]: feat - реализована синхронизация данных через DataSyncService
- [server]: feat - добавлен механизм кэширования для всех сервисов
- [server]: fix - исправлены проблемы с обработкой ошибок при недоступности внешних API
- [server]: refactor - улучшена структура маршрутов API
- [memory-bank]: feat - добавлены архитектурные принципы KISS, DRY и DDD
- [memory-bank]: feat - добавлен файл истории разработки (developmentLog.md)

### Исправленные ошибки
- Исправлена проблема с утечкой памяти при длительной работе сервиса
- Исправлена ошибка в расчете фаз луны на некоторые даты
- Исправлены проблемы с кэшированием данных при ошибках записи в файловую систему
- Улучшена обработка ошибок в сервисе синхронизации данных

## Ключевые задачи и проблемы

### Приоритетные задачи
1. Завершить восстановление всех удаленных файлов
2. Завершить тестирование серверной части
3. Настроить CI/CD для автоматического деплоя
4. Оптимизировать алгоритмы расчета фаз луны
5. Улучшить стратегию кэширования для снижения нагрузки на внешние API

### Текущие проблемы
1. Лимиты запросов к CoinGecko API могут быть превышены при высокой нагрузке
2. Рассинхронизация данных между различными сервисами при ошибках внешних API
3. Проблемы с точностью вычисления фаз луны в некоторых граничных случаях
4. Необходимо полное восстановление всех удаленных сервисов и файлов

## Открытые вопросы и решения

1. **База данных**: Для хранения пользовательских событий используется SQLite, но требуется решить, нужна ли более мощная БД для производственной среды.
2. **Оптимизация данных**: Необходимо улучшить механизмы кэширования для снижения количества запросов к внешним API.
3. **Расширение функциональности**: Планируется добавление новых типов данных и аналитических инструментов.
4. **Деплой**: Необходимо определить стратегию деплоя приложения для продакшн.
5. **CI/CD**: Планируется интеграция тестов с системой непрерывной интеграции.

## Принятые соглашения

Для обеспечения единообразного подхода к работе с репозиторием утвержден следующий формат коммит-сообщений:

```
[область]: тип - краткое описание
```

**Области**: `client`, `server`, `common`, `infra`, `docs`, `memory-bank`  
**Типы**: `feat`, `fix`, `refactor`, `style`, `docs`, `test`, `perf`, `chore`

Примеры:

- `[client]: feat - добавлен компонент для отображения фаз луны`
- `[server]: fix - исправлена ошибка кэширования данных в BitcoinService`
- `[memory-bank]: docs - обновлена документация по архитектуре`

## Система тестирования

Для проекта настроена комплексная система тестирования:

### Серверная часть

- **Фреймворк**: Jest
- **Тестирование API**: Supertest
- **Структура**: Тесты для сервисов, маршрутов и утилит

### Клиентская часть

- **Фреймворк**: Jest
- **Тестирование компонентов**: React Testing Library
- **Структура**: Тесты для компонентов и хуков

## Текущий статус развертывания

### Окружения
- **Разработка**: Локальное окружение разработчиков
- **Тестирование**: Недоступно (в процессе настройки)
- **Продакшн**: Недоступно (планируется после завершения развития MVP)

### Зависимости
- Внешние API:
  - CoinGecko API: Доступен, используется для получения данных о цене биткоина
  - FarmSense API: Доступен, используется для получения данных о фазах луны

## Правильная структура проекта

**ВАЖНО**: При работе с проектом всегда учитывать правильную структуру:

- Серверная часть (Backend) находится в директории `bitcoin-moon/server/`

  - Все серверные сервисы → `bitcoin-moon/server/src/services/`
  - Все серверные утилиты → `bitcoin-moon/server/src/utils/`
  - Все серверные маршруты → `bitcoin-moon/server/src/routes/`
  - Все серверные модели → `bitcoin-moon/server/src/models/`
  - Все серверные тесты → `bitcoin-moon/server/__tests__/`

- Клиентская часть (Frontend) находится в директории `bitcoin-moon/client/`
  - Все клиентские компоненты → `bitcoin-moon/client/src/components/`
  - Все клиентские утилиты → `bitcoin-moon/client/src/utils/`
  - Все клиентские сервисы → `bitcoin-moon/client/src/services/`
  - Все клиентские хуки → `bitcoin-moon/client/src/hooks/`
  - Все клиентские тесты → `bitcoin-moon/client/__tests__/`

Никогда не создавать файлы в корне проекта, кроме конфигурационных файлов для всего проекта!

## Предстоящие решения и дизайн

### Планируемые архитектурные изменения
- Переход на микросервисную архитектуру для улучшения масштабируемости
- Внедрение очереди сообщений для асинхронной обработки данных
- Добавление WebSocket для реал-тайм обновлений на клиенте

### Технические исследования
- Анализ возможности использования собственных алгоритмов расчета фаз луны
- Исследование альтернативных источников данных о цене биткоина
- Оценка потенциала машинного обучения для поиска корреляций между данными 