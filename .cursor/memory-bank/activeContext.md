# Активный контекст проекта MoonBit

## Текущий фокус работы

- Разработка сервиса на основе пакета astronomia для получения реальных данных о фазах Луны
- Мониторинг логов сервера и клиента для выявления и исправления ошибок запуска
- Исправление проблем совместимости модулей CommonJS и ES в бэкенде
- Обеспечение корректной работы в Docker-контейнерах
- Исправление ошибок визуализации в компоненте BitcoinChartWithLunarPhases

## Последние изменения

- Создан AstroService для работы с реальными данными о фазах Луны
- Обновлен сервис astroEvents для использования нового AstroService
- Переписаны модули бэкенда с CommonJS на ES модули для единообразия
- Решена проблема с чувствительностью к регистру в именах файлов маршрутов
- Добавлена зависимость `astronomia` для клиентской части
- Исправлена ошибка отображения маркеров на графике путем добавления сортировки по времени
- Удалены неиспользуемые импорты React в компонентах для соответствия требованиям ESLint

## Активные решения и соображения

### Соглашение по именованию файлов

В проекте MoonBit используется следующее соглашение по именованию файлов:

- **PascalCase** для именования классов, компонентов и сервисов (например, `AstroService.js`, `BitcoinPrice.js`)
- **camelCase** для именования утилит, хуков и функций (например, `astroEvents.js`, `useLocalStorage.js`)

Это соответствует общепринятым стандартам в React и JavaScript, где:
- PascalCase используется для именования компонентов и классов
- camelCase используется для функций и переменных

### Мониторинг логов и устранение ошибок запуска

**Текущие проблемы и их решения:**

1. **Проблема с файлами маршрутов в Docker:**
   - Ошибка: `Cannot find module '/app/src/routes/events.js'`
   - Причина: регистр файлов или отсутствие копирования в Docker-образ
   - Решение: проверка наличия файлов и настройка Docker для корректного копирования

2. **Отсутствующие зависимости клиента:**
   - Ошибка: `Failed to resolve import "astronomia" from "src/services/astroEvents.js"`
   - Решение: добавление пакета `astronomia` в package.json клиента

3. **Ошибка отображения маркеров на графике:**
   - Ошибка: не отображались маркеры лунных фаз на графике биткоина
   - Причина: маркеры не были отсортированы по времени
   - Решение: добавлена сортировка массива маркеров перед вызовом setMarkers

4. **ESLint ошибки в React компонентах:**
   - Ошибка: "React is defined but never used" в компонентах
   - Решение: удалены неиспользуемые импорты React из всех компонентов

### Стратегия обработки ошибок

- Постоянный мониторинг логов при запуске в Docker и локально
- Немедленное исправление ошибок, связанных с отсутствующими файлами или зависимостями
- Ведение списка исправленных проблем для предотвращения их повторения
- Регулярная очистка кэша Docker-контейнеров для избежания проблем с устаревшими слоями

## Следующие шаги

1. Интегрировать новый AstroService с компонентами отображения на дашборде
2. Добавить отображение предстоящих лунных фаз в виджете предстоящих событий
3. Улучшить отображение исторических лунных фаз на графике в соответствии с выбранным таймфреймом
4. Настроить правильную установку пакетов при сборке Docker-образов
5. Улучшить Dockerfile для корректной работы с ES модулями
6. Настроить CI/CD для автоматического тестирования и деплоя
