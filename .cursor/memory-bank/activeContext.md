# Активный контекст проекта MoonBit

## Текущий фокус работы

- Интеграция сервиса AstroService с компонентами отображения на дашборде
- Улучшение отображения лунных фаз в виджете предстоящих событий и на графике
- Проверка корректной работы после интеграции новых компонентов
- Оптимизация сортировки данных по времени для предотвращения ошибок отображения
- Расширение функциональности дашборда для полноценного отображения астрономических данных

## Последние изменения

- Обновлен компонент LunarEventsWidget для использования AstroService вместо EventsService
- Улучшен формат отображения дат в виджете лунных событий (относительные даты для близких событий)
- Обновлен компонент BitcoinChartWithLunarPhases для использования AstroService
- Исправлена проблема с сортировкой маркеров на графике, добавлена явная сортировка по времени
- Добавлено дополнительное логирование для отслеживания процесса отображения данных
- Улучшено форматирование и стилизация виджета предстоящих лунных событий
- Добавлена генерация моковых данных в AstroService для работы при недоступности API
- Реализована проверка содержимого ответов API и автоматическое переключение на моковые данные
- Унифицирована структура данных между моковыми данными и данными API

## Активные решения и соображения

### Использование AstroService для получения реальных данных

AstroService стал центральным сервисом для работы с астрономическими данными:
- Клиентская часть использует API сервера через AstroService для получения данных
- Серверная часть выполняет расчеты с помощью библиотеки astronomia
- Все компоненты, отображающие лунные данные, переведены на использование AstroService

### Отказоустойчивость клиентской части

Реализован подход с резервными моковыми данными для обеспечения бесперебойной работы:
- AstroService проверяет полученные от API данные и автоматически переключается на моковые данные при необходимости
- Генерируются специфические моковые данные для каждого типа API-запроса
- Добавлено подробное логирование для облегчения отладки
- Сохраняется единообразие структуры данных вне зависимости от их источника

### Соглашение по именованию файлов

В проекте MoonBit используется следующее соглашение по именованию файлов:

- **PascalCase** для именования классов, компонентов и сервисов (например, `AstroService.js`, `BitcoinPrice.js`)
- **camelCase** для именования утилит, хуков и функций (например, `astroEvents.js`, `useLocalStorage.js`)

Это соответствует общепринятым стандартам в React и JavaScript, где:
- PascalCase используется для именования компонентов и классов
- camelCase используется для функций и переменных

### Решение проблем с отображением данных на графике

**Текущие проблемы и их решения:**

1. **Сортировка маркеров на графике:**
   - Проблема: маркеры не отображались из-за неправильной сортировки по времени
   - Решение: добавлена явная сортировка маркеров с использованием `sort((a, b) => a.time - b.time)`
   - Добавлена проверка, отсортированы ли маркеры перед добавлением на график

2. **Форматирование времени для отображения:**
   - Проблема: временные метки имели разные форматы (Date, строки, Unix timestamp)
   - Решение: введено единообразное использование Unix timestamp (секунды) для всех компонентов

3. **Улучшение отображения дат в виджетах:**
   - Проблема: даты отображались в абсолютном формате, независимо от близости события
   - Решение: добавлено относительное отображение дат (сегодня, завтра, через N дней)

## Следующие шаги

1. ✅ Интегрировать AstroService с компонентами отображения на дашборде
2. ✅ Добавить отображение предстоящих лунных фаз в виджете предстоящих событий
3. ✅ Улучшить отображение исторических лунных фаз на графике
4. ✅ Обеспечить работу клиентской части при недоступности API сервера
5. Реализовать анализ корреляции между лунными фазами и движением цены биткоина
6. Добавить кнопку обновления данных для ручного получения актуальной информации
7. Улучшить визуализацию маркеров на графике для лучшего выделения важных событий
8. Добавить возможность скрытия/отображения разных типов маркеров на графике
9. Добавить визуальную индикацию источника данных (API или моковые) для пользователя
