# Архитектурные принципы MoonBit

## Основные принципы

### KISS (Keep It Simple, Stupid)

- Стремимся к простоте решений и избегаем ненужных усложнений
- Каждый компонент должен решать одну конкретную задачу
- Предпочитаем понятные решения сложным оптимизациям без измеримой выгоды
- Код должен быть читаемым и понятным для всех участников команды

Примеры применения:

- Простые и понятные API с минимальным количеством параметров
- Компоненты с ясной зоной ответственности
- Предпочтение стандартных решений кастомным, если это не оправдано требованиями

### DRY (Don't Repeat Yourself)

- Избегаем дублирования кода и данных
- Выделяем повторяющиеся фрагменты в отдельные функции или компоненты
- Создаем абстракции для повторяющихся бизнес-процессов
- Используем автоматизацию для повторяющихся операций

Примеры применения:

- Общие утилиты для работы с API и данными
- Переиспользуемые React-компоненты
- Единая система обработки ошибок
- Shared-схемы валидации между клиентом и сервером

### DDD (Domain-Driven Design)

- Моделируем программное обеспечение на основе предметной области
- Определяем четкие границы между различными доменами
- Используем единый язык для общения между разработчиками и экспертами предметной области
- Создаем выразительные модели, отражающие реальные концепции предметной области

Примеры применения:

- Организация кода вокруг бизнес-доменов (Bitcoin, Moon, Astro)
- Использование терминологии предметной области в именах классов и методов
- Выделение основных сущностей и их взаимосвязей
- Разделение сложной логики на контексты с четкими границами

## Конкретные проявления в коде

### KISS

```javascript
// Пример применения KISS - простая функция с понятным назначением
function formatPrice(price, currency) {
  const symbols = {
    usd: '$',
    eur: '€',
    rub: '₽',
  };

  return `${symbols[currency] || ''}${price.toFixed(2)}`;
}
```

### DRY

```javascript
// Пример применения DRY - абстракция для кэширования
class CacheableService {
  loadCache(filePath, defaultValue) {
    try {
      if (fs.existsSync(filePath)) {
        return JSON.parse(fs.readFileSync(filePath, 'utf8'));
      }
    } catch (error) {
      logger.error(`Ошибка при загрузке кэша`, { error });
    }
    return defaultValue;
  }

  // Другие общие методы для работы с кэшем...
}

// Использование в конкретных сервисах
class BitcoinService extends CacheableService {
  // Специфичные методы...
}
```

### DDD

```javascript
// Пример применения DDD - модель отражает предметную область
class MoonPhase {
  constructor(date, phaseValue) {
    this.date = date;
    this.phaseValue = phaseValue; // от 0 до 1
  }

  getName() {
    // Фазы названы в соответствии с предметной областью
    const phaseNames = [
      'Новолуние',
      'Молодая луна (серп)',
      'Первая четверть',
      'Растущая луна (горб)',
      'Полнолуние',
      'Убывающая луна (горб)',
      'Последняя четверть',
      'Старая луна (серп)',
    ];

    const phaseIndex = Math.round(this.phaseValue * 8) % 8;
    return phaseNames[phaseIndex];
  }

  isSignificant() {
    // Проверка, является ли фаза "значимой" (новолуние или полнолуние)
    const normalizedPhase = this.phaseValue % 1;
    return normalizedPhase < 0.05 || (normalizedPhase > 0.45 && normalizedPhase < 0.55);
  }
}
```

## Применение принципов на уровне архитектуры

1. **Модульность**

   - Разделение на слабо связанные сервисы (KISS, DDD)
   - Четкие границы между модулями (DDD)
   - Стандартизированные интерфейсы взаимодействия (DRY)

2. **Слоистая архитектура**

   - Четкое разделение слоев (KISS)
   - Единообразное взаимодействие между слоями (DRY)
   - Слои отражают домены предметной области (DDD)

3. **Управление состоянием**
   - Простая и понятная модель состояния (KISS)
   - Переиспользуемые механизмы управления состоянием (DRY)
   - Состояние организовано вокруг бизнес-доменов (DDD)

## Меры для поддержания принципов

1. **Код-ревью** с фокусом на соблюдение этих принципов
2. **Рефакторинг** для устранения нарушений
3. **Автоматизированные проверки** стиля и сложности кода
4. **Документирование** решений и моделей предметной области
5. **Регулярные обсуждения** архитектуры и применяемых принципов
