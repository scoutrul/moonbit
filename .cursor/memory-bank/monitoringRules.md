# Правила мониторинга и устранения ошибок

## Мониторинг логов

### Серверные логи

Для мониторинга логов сервера используем следующие команды:

```bash
# Просмотр логов сервера
docker logs moonbit-server

# Просмотр логов с постоянным обновлением
docker logs -f moonbit-server

# Просмотр последних 100 строк
docker logs --tail 100 moonbit-server
```

### Клиентские логи

Для мониторинга логов клиента:

```bash
# Просмотр логов клиента
docker logs moonbit-client

# Просмотр логов с постоянным обновлением
docker logs -f moonbit-client
```

## Процесс устранения ошибок

### 1. Выявление ошибки

- Мониторить логи при каждом запуске/перезапуске контейнеров
- Обращать внимание на сообщения ERROR, WARN, Failed, Error
- Проверять наличие ошибок в консоли браузера при запущенном клиенте

### 2. Анализ ошибки

Типичные категории ошибок:

1. **Ошибки модулей/зависимостей:**
   - Отсутствующие пакеты в package.json
   - Несовместимые версии пакетов
   - Проблемы с импортом модулей

2. **Ошибки Docker:**
   - Проблемы с копированием файлов
   - Отсутствующие файлы в контейнере
   - Проблемы с переменными окружения

3. **Ошибки API:**
   - Недоступность внешних API
   - Неправильные параметры запросов
   - Истечение временных токенов

### 3. Исправление ошибок

**Для ошибок с зависимостями:**
- Добавить отсутствующий пакет в package.json
- Явно установить пакет в Dockerfile
- Проверить совместимость версий пакетов

**Для проблем с Docker:**
- Проверить порядок копирования файлов в Dockerfile
- Добавить проверки наличия файлов во время сборки
- Настроить правильные переменные окружения

**Для проблем с API:**
- Реализовать механизмы повторных попыток
- Использовать кэширование для уменьшения количества запросов
- Обеспечить корректную обработку ошибок

## Превентивные меры

1. **Автоматический мониторинг:**
   - Настроить систему оповещений о критических ошибках
   - Добавить автоматические проверки статуса сервисов

2. **Тестирование Docker-сборок:**
   - Запускать полное тестирование после изменения Dockerfile
   - Проверять наличие всех необходимых файлов в контейнере

3. **Управление зависимостями:**
   - Регулярно обновлять зависимости в package.json
   - Использовать lock-файлы для фиксации версий
   - Синхронизировать зависимости между package.json и Dockerfile

## Проверочный список при запуске

При каждом запуске проекта необходимо проверить:

1. **Запуск контейнеров:**
   ```bash
   docker compose ps
   ```

2. **Логи сервера:**
   ```bash
   docker logs moonbit-server
   ```

3. **Логи клиента:**
   ```bash
   docker logs moonbit-client
   ```

4. **Доступность сервисов:**
   - Проверить доступность сервера: http://localhost:3001/api/bitcoin/current
   - Проверить доступность клиента: http://localhost:3000 